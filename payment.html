<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payment - Nebula Store</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex: 1;
      padding: 2rem 1rem;
    }

    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 2rem;
      margin: 2rem auto;
      max-width: 600px;
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
      color: #fff;
    }

    .glass h2 {
      margin-bottom: 1.5rem;
      text-align: center;
      color: #00f0ff;
    }

    .glass label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
    }

    .glass input,
    .glass select,
    .glass textarea {
      width: 100%;
      padding: 0.8rem;
      margin-top: 0.5rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
    }

    .glass button {
      margin-top: 2rem;
      width: 100%;
      padding: 0.8rem;
      border: none;
      border-radius: 10px;
      background: #00f0ff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .glass button:hover {
      background: #00c8d6;
    }

    #metodeInfo {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #ffcc00;
    }

    #strukStatus {
      text-align: center;
      margin-top: 1rem;
      font-weight: bold;
    }

    #qrisImg img {
      width: 200px;
      border-radius: 10px;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="nebula-bg"></div>

  <header>
    <nav>
      <div class="logo">Nebula Store</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="produk.html">Produk</a></li>
        <li><a href="bestseller.html">Best Seller</a></li>
        <li><a href="flashsale.html">Flash Sale</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="kontak.html">Kontak</a></li>
      </ul>
      <div class="music-toggle" onclick="toggleMusic()">üéµ</div>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h1>Pembayaran</h1>
    </section>

    <!-- Pilih Produk -->
    <div class="glass">
      <h2>1. Pilih Produk</h2>
      <select id="productSelect">
        <option value="" disabled selected>-- Pilih Produk --</option>
      </select>
      <p>Harga: <strong id="hargaTxt">-</strong></p>
    </div>

    <!-- Metode Pembayaran -->
    <div class="glass">
      <h2>2. Metode Pembayaran</h2>
      <select id="metodeSelect">
        <option value="" disabled selected>-- Pilih Metode --</option>
        <option value="qris">QRIS</option>
        <option value="dana">Dana</option>
        <option value="gopay">GoPay</option>
        <option value="ovo">OVO</option>
      </select>
      <div id="metodeInfo"></div>
    </div>

    <!-- Data Pembayaran -->
    <div class="glass">
      <h2>3. Data Pembayaran</h2>
      <form id="formPayment" onsubmit="handleBayar(event)">
        <label>Atas Nama Pengirim</label>
        <input type="text" id="namaPengirim" placeholder="Contoh: Andi Wijaya" required />

        <label>Nomor WhatsApp</label>
        <input type="tel" id="waPengirim" placeholder="Contoh: 6281234567890" required />

        <label>Username Telegram</label>
        <input type="text" id="telePengirim" placeholder="Contoh: @andi_wijaya" required />

        <label>Bukti Transfer (gambar)</label>
        <input type="file" id="buktiTF" accept="image/*" required />

        <button type="submit">Kirim & Buat Struk</button>
        <p id="strukStatus"></p>
      </form>
    </div>
  </main>

  <footer>
    <div class="social-icons">
      <a href="https://wa.me/6281234567890" target="_blank">üì≤</a>
      <a href="https://t.me/username" target="_blank">‚úàÔ∏è</a>
      <a href="https://tiktok.com/@resellergaming" target="_blank">üéµ</a>
    </div>
    <p>&copy; 2025 Reseller Gaming. All rights reserved.</p>
  </footer>

  <audio id="bgMusic" loop>
    <source src="assets/music/nebula.mp3" type="audio/mp3" />
  </audio>

  <script src="js/main.js"></script>
  <script>
    // Isi pilihan produk
    const productSelect = document.getElementById("productSelect");
    const hargaTxt = document.getElementById("hargaTxt");
    const urlParams = new URLSearchParams(location.search);
    const prodParam = urlParams.get("product");
    const priceParam = urlParams.get("price");

    fetch("data/products.json")
      .then(r => r.json())
      .then(data => {
        data.forEach(p => {
          const opt = document.createElement("option");
          opt.value = p.price;
          opt.textContent = p.name;
          if (p.name === prodParam) opt.selected = true;
          productSelect.appendChild(opt);
        });
        if (prodParam && priceParam) {
          hargaTxt.textContent = `Rp${Number(priceParam).toLocaleString()}`;
        }
      });

    productSelect.onchange = () => {
      const harga = Number(productSelect.value);
      hargaTxt.textContent = `Rp${harga.toLocaleString()}`;
    };

    // Info metode bayar
    const metodeSelect = document.getElementById("metodeSelect");
    const metodeInfo = document.getElementById("metodeInfo");
    const dataRek = {
      dana: { nomor: "0857-1234-5678", atas: "A/N Reseller Gaming Dana" },
      gopay: { nomor: "0857-1234-5679", atas: "A/N Reseller Gaming GoPay" },
      ovo: { nomor: "0857-1234-5680", atas: "A/N Reseller Gaming OVO" }
    };

    metodeSelect.onchange = () => {
      const metode = metodeSelect.value;
      if (metode === "qris") {
        metodeInfo.innerHTML = `<p>Scan kode QRIS berikut:</p><img src="assets/images/qris.jpg" alt="QRIS">`;
      } else if (dataRek[metode]) {
        const rek = dataRek[metode];
        metodeInfo.innerHTML = `<p>Nomor: <strong>${rek.nomor}</strong><br>${rek.atas}</p>`;
      } else {
        metodeInfo.innerHTML = "";
      }
    };

    // Handle submit
    async function handleBayar(e) {
      e.preventDefault();
      const status = document.getElementById("strukStatus");

      const produk = productSelect.options[productSelect.selectedIndex].text;
      const harga = Number(productSelect.value);
      const metode = metodeSelect.value;
      const nama = document.getElementById("namaPengirim").value;
      const wa = document.getElementById("waPengirim").value;
      const tele = document.getElementById("telePengirim").value;
      const bukti = document.getElementById("buktiTF").files[0];

      if (!metode) { status.textContent = "‚ùå Pilih metode pembayaran!"; return; }
      if (!bukti) { status.textContent = "‚ùå Upload bukti transfer!"; return; }

      const idStruk = "RESMING-" + Math.floor(10000000 + Math.random() * 90000000);
      const reader = new FileReader();

      reader.onload = async function () {
        const base64 = reader.result.split(",")[1];
        const botToken = "GANTI_BOT_TOKEN";
        const chatId = "GANTI_CHAT_ID";
        const caption = `üìÑ Struk Pembayaran\n\nID: ${idStruk}\nProduk: ${produk}\nHarga: Rp${harga.toLocaleString()}\nMetode: ${metode.toUpperCase()}\nNama: ${nama}\nWA: ${wa}\nTele: ${tele}`;

        const formData = new FormData();
        formData.append("chat_id", chatId);
        formData.append("caption", caption);
        formData.append("photo", `data:image/jpeg;base64,${base64}`);

        try {
          const res = await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
            method: "POST",
            body: formData
          });
          const data = await res.json();
          if (data.ok) {
            status.innerHTML = `‚úÖ Struk terkirim! ID: <strong>${idStruk}</strong>`;
            document.getElementById("formPayment").reset();
            metodeInfo.innerHTML = "";
          } else {
            status.textContent = "‚ùå Gagal kirim ke Telegram.";
          }
        } catch (err) {
          status.textContent = "‚ùå Error jaringan.";
          console.error(err);
        }
      };
      reader.readAsDataURL(bukti);
    }
  </script>
</body>
              </html>
